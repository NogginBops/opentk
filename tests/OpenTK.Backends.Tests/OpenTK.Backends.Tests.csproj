<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>net8.0</TargetFramework>
    <Nullable>enable</Nullable>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <LangVersion>12.0</LangVersion>
    <!-- Uncomment this if not using the .res resource file. -->
    <!--<ApplicationIcon>Resources\opentk_logo_small.ico</ApplicationIcon>-->

    <!-- FIXME: We want to fix it so you don't have to have the manifest file... 
         or make it so that the resource file can contain the manifest and that we load it correctly.
    -->
    <!-- Uncomment this if not using the .res resource file. -->
    <!--<ApplicationManifest>app.manifest</ApplicationManifest>-->
    <!--<Win32Resource>icons.res</Win32Resource>-->
  </PropertyGroup>

  <ItemGroup>
    <None Remove="ANGLE_LICENCE" />
    <Content Include="ANGLE_LICENCE" />
  </ItemGroup>

  <ItemGroup>
    <Content Include="Resources\opentk_logo_small.ico">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
  </ItemGroup>

  <ItemGroup>
    <!-- Maybe add condition on compiling for macOS? -->
    <Content Include="info.plist" Condition="'$(_IsPublishing)' == 'true' and '$(Platform)' == 'osx'">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
  </ItemGroup>

  <!-- This compiles the icons.rc file into icons.res file if we can find a rc.exe at a very specific path -->
  <!-- We would ideally have a better way of getting access to the rc.exe path, but this will do for this demo... -->
  <Target Name="RC file" BeforeTargets="PreBuildEvent" Condition="Exists('C:\Program Files (x86)\Windows Kits\10\bin\10.0.22000.0\x64\rc.exe')">
    <Message Importance="High" Text="Compiling resource file" />
    <Exec Command="&quot;C:\Program Files (x86)\Windows Kits\10\bin\10.0.22000.0\x64\rc.exe&quot; icons.rc" />
    <Message Importance="high" Text="Publishing: '$(_IsPublishing)', Platform: '$(Platform)', OS: '$(OS)'"/>
  </Target>

  <ItemGroup>
    <PackageReference Include="StbImageSharp" Version="2.27.14" />
    <PackageReference Include="StbImageWriteSharp" Version="1.16.7" />
    <PackageReference Include="ImGui.NET" Version="1.91.6.1" />
    <PackageReference Include="OpenTK.redist.SDL" Version="2.26.5-pre20230414185304" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\src\OpenTK.Core\OpenTK.Core.csproj" />
    <ProjectReference Include="..\..\src\OpenTK.Graphics\OpenTK.Graphics.csproj" />
    <ProjectReference Include="..\..\src\OpenTK.Platform\OpenTK.Platform.csproj" />
    <ProjectReference Include="..\Bejeweled\Bejeweled.csproj" />
  </ItemGroup>

  <ItemGroup>
    <Compile Update="Icons.Designer.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>Icons.resx</DependentUpon>
    </Compile>
  </ItemGroup>

  <ItemGroup>
    <EmbeddedResource Update="Icons.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>Icons.Designer.cs</LastGenOutput>
    </EmbeddedResource>
  </ItemGroup>

  <ItemGroup>
    <Content Include="win32-x64/d3dcompiler_47.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
      <Content Include="win32-x64/libEGL.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="win32-x64/libGLESv1_CM.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="win32-x64/libGLESv2.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="linux-x64/angle-linux-binaries.zip">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="Resources\Cute Light Green Normal Select.cur">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
      <Content Include="Resources\NotoSans\NotoSansJP-Regular.ttf">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="Resources\NotoSans\OFL.txt">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="Resources\ProggyVector\LICENSE.txt">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="Resources\ProggyVector\ProggyVectorDotted.ttf">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="Resources\Wikipedia-Flags-UN-United-Nations-Flag.ico">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="SDL2.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="win32-x64\soft_oal.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <!-- The Bejeweled project includes it's own version of this dll, we get a publish error if we include it here too. -->
      <CopyToPublishDirectory>Never</CopyToPublishDirectory>
    </Content>
  </ItemGroup>
</Project>
